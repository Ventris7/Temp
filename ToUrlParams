// queryHelpers.ts

/**
 * Рекурсивно кладёт объект в URLSearchParams в виде:
 * model.a=1&model.b.c=2&model.tags=one&model.tags=two
 */
export function objectToQueryParams(
  rootName: string,
  obj: unknown,
  params: URLSearchParams = new URLSearchParams(),
): URLSearchParams {
  const append = (key: string, value: unknown) => {
    if (value === null || value === undefined) return;

    if (value instanceof Date) {
      params.append(key, value.toISOString());
      return;
    }

    if (Array.isArray(value)) {
      // массив → повторяющиеся ключи: model.tags=a&model.tags=b
      for (const item of value) {
        append(key, item);
      }
      return;
    }

    if (typeof value === 'object') {
      for (const [childKey, childValue] of Object.entries(value as Record<string, unknown>)) {
        const nextKey = key ? `${key}.${childKey}` : childKey;
        append(nextKey, childValue);
      }
      return;
    }

    // примитивы: string | number | boolean
    params.append(key, String(value));
  };

  append(rootName, obj);

  return params;
}

/**
 * Удобный шорткат: вернёт строку "?model.a=1&model.b.c=2"
 */
export function buildQueryString(rootName: string, obj: unknown): string {
  const params = objectToQueryParams(rootName, obj);
  const qs = params.toString();
  return qs ? `?${qs}` : '';
}
